{
  "name": "PDF Price Analyzer - Lenses",
  "nodes": [
    {
      "parameters": {
        "updates": [
          "message"
        ]
      },
      "id": "telegram-trigger",
      "name": "Telegram Trigger",
      "type": "n8n-nodes-base.telegramTrigger",
      "typeVersion": 1.1,
      "position": [250, 300],
      "webhookId": "telegram-pdf-price-analyzer"
    },
    {
      "parameters": {
        "operation": "getFile",
        "fileId": "={{ $json.message.document.file_id }}"
      },
      "id": "get-telegram-file",
      "name": "Get Telegram File",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [450, 300]
    },
    {
      "parameters": {
        "operation": "download",
        "filePath": "={{ $json.file_path }}"
      },
      "id": "download-file",
      "name": "Download PDF File",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [650, 300]
    },
    {
      "parameters": {
        "operation": "extractText",
        "binaryPropertyName": "data",
        "options": {
          "extractTables": true,
          "extractImages": false
        }
      },
      "id": "extract-pdf",
      "name": "Extract PDF Text",
      "type": "n8n-nodes-base.extractPdf",
      "typeVersion": 1,
      "position": [850, 300]
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=–¢—ã ‚Äî –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π ¬´–ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –ø—Ä–∞–π—Å–æ–≤ –Ω–∞ –ª–∏–Ω–∑—ã¬ª.\n–¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç –∏–∑ PDF —Ñ–∞–π–ª–∞ –ø—Ä–∞–π—Å–∞ –∏ –∏–∑–≤–ª–µ—á—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –æ –ª–∏–Ω–∑–∞—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ.\n\n–ù–ê –í–•–û–î –¢–ï–ë–ï –ü–ï–†–ï–î–ê–Æ–¢:\n- –¢–µ–∫—Å—Ç –∏ —Ç–∞–±–ª–∏—Ü—ã, –∏–∑–≤–ª–µ—á–µ–Ω–Ω—ã–µ –∏–∑ PDF —Ñ–∞–π–ª–∞ –ø—Ä–∞–π—Å–∞ –Ω–∞ –ª–∏–Ω–∑—ã\n- –î–∞–Ω–Ω—ã–µ –º–æ–≥—É—Ç –±—ã—Ç—å –≤ —Ä–∞–∑–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–∞—Ö: —Ç–∞–±–ª–∏—Ü—ã, —Å–ø–∏—Å–∫–∏, —Å–º–µ—à–∞–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç\n\n–¢–í–û–Ø –ó–ê–î–ê–ß–ê:\n1. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–∞–π—Å–∞ (—Ç–∞–±–ª–∏—Ü–∞, —Å–ø–∏—Å–æ–∫, —Å–º–µ—à–∞–Ω–Ω—ã–π)\n2. –ò–∑–≤–ª–µ—á—å –¥–∞–Ω–Ω—ã–µ –ø–æ –∫–∞–∂–¥–æ–π –ø–æ–∑–∏—Ü–∏–∏ –ª–∏–Ω–∑:\n   - –ù–∞–∑–≤–∞–Ω–∏–µ/–º–æ–¥–µ–ª—å –ª–∏–Ω–∑—ã\n   - –ê—Ä—Ç–∏–∫—É–ª/SKU (–µ—Å–ª–∏ –µ—Å—Ç—å)\n   - –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å/–±—Ä–µ–Ω–¥\n   - –¶–µ–Ω–∞ —Ä–æ–∑–Ω–∏—á–Ω–∞—è (–µ—Å–ª–∏ –µ—Å—Ç—å)\n   - –¶–µ–Ω–∞ –æ–ø—Ç–æ–≤–∞—è (–µ—Å–ª–∏ –µ—Å—Ç—å)\n   - –ú–∞—Ç–µ—Ä–∏–∞–ª (–ø–ª–∞—Å—Ç–∏–∫, —Å—Ç–µ–∫–ª–æ, –ø–æ–ª–∏–∫–∞—Ä–±–æ–Ω–∞—Ç –∏ —Ç.–¥.)\n   - –ü–æ–∫—Ä—ã—Ç–∏–µ (–∞–Ω—Ç–∏–±–ª–∏–∫, –∑–∞—â–∏—Ç–∞ –æ—Ç —Å–∏–Ω–µ–≥–æ —Å–≤–µ—Ç–∞, —Ñ–æ—Ç–æ—Ö—Ä–æ–º –∏ —Ç.–¥.)\n   - –ò–Ω–¥–µ–∫—Å –ø—Ä–µ–ª–æ–º–ª–µ–Ω–∏—è (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω)\n   - –î–∏–∞–º–µ—Ç—Ä (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω)\n   - –ö–∞—Ç–µ–≥–æ—Ä–∏—è (–æ–¥–Ω–æ—Ñ–æ–∫–∞–ª—å–Ω—ã–µ, –ø—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–µ, –º—É–ª—å—Ç–∏—Ñ–æ–∫–∞–ª—å–Ω—ã–µ, –∫–æ–º–ø—å—é—Ç–µ—Ä–Ω—ã–µ –∏ —Ç.–¥.)\n   - –ù–∞–ª–∏—á–∏–µ/–æ—Å—Ç–∞—Ç–∫–∏ (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω–æ)\n   - –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏\n3. –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–≤–µ—Ç —Å—Ç—Ä–æ–≥–æ –≤ –≤–∏–¥–µ JSON –º–∞—Å—Å–∏–≤–∞:\n{\n  \"items\": [\n    {\n      \"name\": \"–ù–∞–∑–≤–∞–Ω–∏–µ –ª–∏–Ω–∑—ã\",\n      \"article\": \"–ê—Ä—Ç–∏–∫—É–ª –∏–ª–∏ –ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞\",\n      \"manufacturer\": \"–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å –∏–ª–∏ –ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞\",\n      \"price_retail\": 0,\n      \"price_wholesale\": 0,\n      \"material\": \"–ú–∞—Ç–µ—Ä–∏–∞–ª –∏–ª–∏ –ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞\",\n      \"coating\": \"–ü–æ–∫—Ä—ã—Ç–∏–µ –∏–ª–∏ –ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞\",\n      \"refractive_index\": 0,\n      \"diameter\": 0,\n      \"category\": \"–ö–∞—Ç–µ–≥–æ—Ä–∏—è –∏–ª–∏ –ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞\",\n      \"stock\": \"–ù–∞–ª–∏—á–∏–µ –∏–ª–∏ –ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞\",\n      \"notes\": \"–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∏–ª–∏ –ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞\"\n    }\n  ],\n  \"metadata\": {\n    \"total_items\": 0,\n    \"source_file\": \"price_list.pdf\"\n  }\n}\n\n–ü–†–ê–í–ò–õ–ê:\n- –ï—Å–ª–∏ –∫–∞–∫–æ–µ-—Ç–æ –ø–æ–ª–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç, –∏—Å–ø–æ–ª—å–∑—É–π –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É –¥–ª—è —Ç–µ–∫—Å—Ç–∞ –∏–ª–∏ 0 –¥–ª—è —á–∏—Å–µ–ª\n- –ù–µ –≤—ã–¥—É–º—ã–≤–∞–π –∑–Ω–∞—á–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç –≤ –ø—Ä–∞–π—Å–µ\n- –ï—Å–ª–∏ —Ü–µ–Ω–∞ —É–∫–∞–∑–∞–Ω–∞ –≤ –æ–¥–Ω–æ–π –≤–∞–ª—é—Ç–µ, —Å–æ—Ö—Ä–∞–Ω—è–π –∫–∞–∫ –µ—Å—Ç—å\n- –ï—Å–ª–∏ –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ü–µ–Ω (—Ä–æ–∑–Ω–∏—á–Ω–∞—è/–æ–ø—Ç–æ–≤–∞—è), –∏–∑–≤–ª–µ–∫–∞–π –æ–±–µ\n- –ö–∞—Ç–µ–≥–æ—Ä–∏—é –æ–ø—Ä–µ–¥–µ–ª—è–π –ø–æ –æ–ø–∏—Å–∞–Ω–∏—é –∏–ª–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞–º\n- –î–ª—è —á–∏—Å–ª–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π (—Ü–µ–Ω—ã, –∏–Ω–¥–µ–∫—Å, –¥–∏–∞–º–µ—Ç—Ä) –∏—Å–ø–æ–ª—å–∑—É–π —á–∏—Å–ª–∞, –Ω–µ —Å—Ç—Ä–æ–∫–∏\n- –ï—Å–ª–∏ –≤ –ø—Ä–∞–π—Å–µ –µ—Å—Ç—å –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ (–ø–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—è–º, –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º), —Å–æ—Ö—Ä–∞–Ω—è–π —ç—Ç—É –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ –ø–æ–ª–µ category –∏–ª–∏ manufacturer\n\n–§–ò–ù–ê–õ:\n–í–æ–∑–≤—Ä–∞—â–∞–π —Ç–æ–ª—å–∫–æ –≤–∞–ª–∏–¥–Ω—ã–π JSON –±–µ–∑ –ª–∏—à–Ω–µ–≥–æ —Ç–µ–∫—Å—Ç–∞ ‚Äî –æ–Ω –ø–æ–π–¥—ë—Ç –≤ Google Sheets.",
        "options": {
          "systemMessage": "=You are a professional price list analyzer. Extract all lens data from the provided text and return structured JSON. Be precise and don't invent data."
        }
      },
      "id": "ai-agent",
      "name": "AI Agent - Price Analyzer",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [1050, 300]
    },
    {
      "parameters": {
        "jsCode": "// –ü–∞—Ä—Å–∏–Ω–≥ JSON –æ—Ç–≤–µ—Ç–∞ –æ—Ç AI –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è Google Sheets\nconst aiResponse = $input.item.json.output || $input.item.json.text || $input.item.json.message?.content || '';\n\n// –ò–∑–≤–ª–µ–∫–∞–µ–º JSON –∏–∑ –æ—Ç–≤–µ—Ç–∞ (–º–æ–∂–µ—Ç –±—ã—Ç—å –æ–±–µ—Ä–Ω—É—Ç –≤ markdown –∏–ª–∏ —Ç–µ–∫—Å—Ç)\nlet jsonData;\ntry {\n  // –ü—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ JSON –≤ –æ—Ç–≤–µ—Ç–µ\n  const jsonMatch = aiResponse.match(/\\{[\\s\\S]*\\}/);\n  if (jsonMatch) {\n    jsonData = JSON.parse(jsonMatch[0]);\n  } else {\n    jsonData = JSON.parse(aiResponse);\n  }\n} catch (error) {\n  throw new Error(`–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON: ${error.message}. –û—Ç–≤–µ—Ç AI: ${aiResponse.substring(0, 200)}`);\n}\n\n// –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∑–∞–ø–∏—Å–∏ –≤ Google Sheets\nconst items = jsonData.items || [];\nconst processedAt = new Date().toISOString();\n\n// –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –∫–∞–∂–¥—ã–π —ç–ª–µ–º–µ–Ω—Ç –≤ —Å—Ç—Ä–æ–∫—É –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã\nconst rows = items.map((item, index) => {\n  return {\n    json: {\n      '–î–∞—Ç–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏': processedAt,\n      '–ù–∞–∑–≤–∞–Ω–∏–µ –ª–∏–Ω–∑—ã': item.name || '',\n      '–ê—Ä—Ç–∏–∫—É–ª': item.article || '',\n      '–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å': item.manufacturer || '',\n      '–¶–µ–Ω–∞ —Ä–æ–∑–Ω–∏—á–Ω–∞—è': item.price_retail || 0,\n      '–¶–µ–Ω–∞ –æ–ø—Ç–æ–≤–∞—è': item.price_wholesale || 0,\n      '–ú–∞—Ç–µ—Ä–∏–∞–ª': item.material || '',\n      '–ü–æ–∫—Ä—ã—Ç–∏–µ': item.coating || '',\n      '–ò–Ω–¥–µ–∫—Å –ø—Ä–µ–ª–æ–º–ª–µ–Ω–∏—è': item.refractive_index || 0,\n      '–î–∏–∞–º–µ—Ç—Ä': item.diameter || 0,\n      '–ö–∞—Ç–µ–≥–æ—Ä–∏—è': item.category || '',\n      '–ù–∞–ª–∏—á–∏–µ': item.stock || '',\n      '–ü—Ä–∏–º–µ—á–∞–Ω–∏—è': item.notes || ''\n    }\n  };\n});\n\nreturn rows;"
      },
      "id": "process-data",
      "name": "Process Data for Sheets",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1250, 300]
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "YOUR_GOOGLE_SHEET_ID",
          "mode": "list"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "–î–∞—Ç–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏": "={{ $json['–î–∞—Ç–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏'] }}",
            "–ù–∞–∑–≤–∞–Ω–∏–µ –ª–∏–Ω–∑—ã": "={{ $json['–ù–∞–∑–≤–∞–Ω–∏–µ –ª–∏–Ω–∑—ã'] }}",
            "–ê—Ä—Ç–∏–∫—É–ª": "={{ $json['–ê—Ä—Ç–∏–∫—É–ª'] }}",
            "–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å": "={{ $json['–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å'] }}",
            "–¶–µ–Ω–∞ —Ä–æ–∑–Ω–∏—á–Ω–∞—è": "={{ $json['–¶–µ–Ω–∞ —Ä–æ–∑–Ω–∏—á–Ω–∞—è'] }}",
            "–¶–µ–Ω–∞ –æ–ø—Ç–æ–≤–∞—è": "={{ $json['–¶–µ–Ω–∞ –æ–ø—Ç–æ–≤–∞—è'] }}",
            "–ú–∞—Ç–µ—Ä–∏–∞–ª": "={{ $json['–ú–∞—Ç–µ—Ä–∏–∞–ª'] }}",
            "–ü–æ–∫—Ä—ã—Ç–∏–µ": "={{ $json['–ü–æ–∫—Ä—ã—Ç–∏–µ'] }}",
            "–ò–Ω–¥–µ–∫—Å –ø—Ä–µ–ª–æ–º–ª–µ–Ω–∏—è": "={{ $json['–ò–Ω–¥–µ–∫—Å –ø—Ä–µ–ª–æ–º–ª–µ–Ω–∏—è'] }}",
            "–î–∏–∞–º–µ—Ç—Ä": "={{ $json['–î–∏–∞–º–µ—Ç—Ä'] }}",
            "–ö–∞—Ç–µ–≥–æ—Ä–∏—è": "={{ $json['–ö–∞—Ç–µ–≥–æ—Ä–∏—è'] }}",
            "–ù–∞–ª–∏—á–∏–µ": "={{ $json['–ù–∞–ª–∏—á–∏–µ'] }}",
            "–ü—Ä–∏–º–µ—á–∞–Ω–∏—è": "={{ $json['–ü—Ä–∏–º–µ—á–∞–Ω–∏—è'] }}"
          }
        },
        "options": {
          "useAppend": true
        }
      },
      "id": "write-to-sheets",
      "name": "Write to Google Sheets",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.3,
      "position": [1450, 300]
    },
    {
      "parameters": {
        "resource": "message",
        "operation": "sendMessage",
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=‚úÖ –ü—Ä–∞–π—Å —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω!\n\nüìä –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ –ø–æ–∑–∏—Ü–∏–π: {{ $('Process Data for Sheets').item.json.length || 0 }}\nüìÖ –î–∞—Ç–∞: {{ new Date().toLocaleString('ru-RU') }}\n\n–î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ Google Sheets."
      },
      "id": "send-notification",
      "name": "Send Notification",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [1650, 300]
    }
  ],
  "connections": {
    "Telegram Trigger": {
      "main": [
        [
          {
            "node": "Get Telegram File",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Telegram File": {
      "main": [
        [
          {
            "node": "Download PDF File",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Download PDF File": {
      "main": [
        [
          {
            "node": "Extract PDF Text",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract PDF Text": {
      "main": [
        [
          {
            "node": "AI Agent - Price Analyzer",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent - Price Analyzer": {
      "main": [
        [
          {
            "node": "Process Data for Sheets",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Process Data for Sheets": {
      "main": [
        [
          {
            "node": "Write to Google Sheets",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Write to Google Sheets": {
      "main": [
        [
          {
            "node": "Send Notification",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [],
  "triggerCount": 0
}
